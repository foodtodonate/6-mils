<?xml version="1.0"encoding="ISO-8859-1" standalone="no" ?>
<!DOCTYPE cXML SYSTEM "http://xml.cxml.org/schemas/cXML/1.2.014/InvoiceDetail.dtd">
<cXML payloadID="{{ payload_id }}" timestamp="{{ timestamp }}" version="1.2.014" xml:lang="{{ language }}" >
    <Header>
        <From>
            <Credential domain="{{ header.from.domain }}">
                <Identity>{{ header.from.identity }}</Identity>
            </Credential>
        </From>
        <To>
            <Credential domain="{{ header.to.domain }}">
                <Identity>{{ header.to.identity }}</Identity>
            </Credential>
        </To>
        <Sender>
            <Credential domain="{{ header.sender.domain }}">
                <Identity>{{ header.sender.identity }}</Identity>
                <SharedSecret>{{ header.sender.shared_secret }}</SharedSecret>
            </Credential>
            <UserAgent>{{ header.sender.user_agent }}</UserAgent>
        </Sender>
    </Header>
    <Request deploymentMode="{{ request.deployment_mode }}">
        {% for request in invoice_detail_req %}
            <InvoiceDetailRequest>
                <InvoiceDetailRequestHeader invoiceDate="{{ request.req_header.invoice_date }}" invoiceID="{{ request.req_header.invoice_id }}" operation="{{ request.req_header.operation }}" purpose="{{ request.req_header.purpose }}" >
                    <InvoiceDetailHeaderIndicator/>
                    <InvoiceDetailLineIndicator isTaxInLine="" ></InvoiceDetailLineIndicator>
                        <InvoicePartner>
                            {% for contact in invoice_partner.contacts %}
                                <Contact role="{{ contact.role }}" addressID="{{ contact.address_id }}" >
                                    <Name xml:lang="{{ contact.language }}"></Name>
                                    <PostalAddress>
                                        <Street>{{ contact.street }}</Street>
                                        <City>{{ contact.city }}</City>
                                        <State>{{ contact.state }}</State>
                                        <PostalCode>{{ contact.postal_code }}</PostalCode>
                                        <Country isoCountryCode="{{ contact.country_code }}" >{{ contact.country }}</Country>
                                    </PostalAddress>
                                </Contact>
                                {% if contact.role == "remitTo"%}
                                    <IdReference domain="{{ invoice_partner.id_ref_domain }}" identifier="{{ invoice_partner.id_ref_identifier }}"></IdReference>
                                {% endif %}
                        </InvoicePartner>
                        {% else %}
                            <InvoicePartner></InvoicePartner>
                        {% endfor %}

                    <InvoiceDetailShipping>
                        {% for contact in invoice_detail_ship.contact %}
                            {% if contact.role == "shipFrom" %}
                                <Contact role="{{ contact.role }}" >
                            {% else %}
                            <Contact addressID="{{ contact.address_id }}" role="{{ contact.role }}" >
                                    <Name xml:lang="{{ contact.language }}" >{{ contact.name }}</Name>
                                    <PostalAddress>
                                        <Street> {{ contact.street }}</Street>
                                        <City>{{ contact.city }}</City>
                                        <State>{{ contact.state }}</State>
                                        <PostalCode></PostalCode>
                                        <Country isoCountryCode="{{ contact.country_code }}" >{{ contact.country }}</Country>
                                    </PostalAddress>
                                </Contact>
                        {% endfor %}
                    </InvoiceDetailShipping>
                    <InvoiceDetailPaymentTerm percentageRate="{{ invoice_detail_payment_term.percent_rate }}" payInNumberOfDays="{{ invoice_detail_payment_term.pay_num_of_days }}" ></InvoiceDetailPaymentTerm>
                </InvoiceDetailRequestHeader>
                <InvoiceDetailOrder>
                    <InvoiceDetailOrderInfo>
                        <OrderReference>
                            <DocumentReference payloadID="{{ invoice_detail_order.info.payload_id }}"/>
                        </OrderReference>
                        <SupplierOrderInfo orderID="{{ invoice_detail_order.info.order_id }}" ></SupplierOrderInfo>
                    </InvoiceDetailOrderInfo>
                    {% for item in invoice_detail_order.item %}
                        <InvoiceDetailItem invoiceLineNumber="{{ item.line_number }}" quantity="{{ item.quantity }}" >
                            <UnitOfMeasure>{{ item.uom }}</UnitOfMeasure>
                            <UnitPrice>
                                <Money currency="{{ item.unit_price_currency }}" >{{ item.unit_price_amt }}</Money>
                            </UnitPrice>
                            <InvoiceDetailItemReference lineNumber="{{ item.line_number }}" >
                                <ItemID>
                                    <SupplierPartID>{{ item.supplier_part_id }}</SupplierPartID>
                                </ItemID>
                                <Description xml:lang="{{ item.desc_lang }}" >{{ item.part_desc }} </Description>
                                <ManufacturerPartID/>
                                <ManufacturerName>{{ item.manufacturer_name }}</ManufacturerName>
                            </InvoiceDetailItemReference>
                            <SubtotalAmount>
                                <Money currency="{{ item.sub_total_currency }}" >{{ item.sub_total_amt }}</Money>
                            </SubtotalAmount>
                                <Tax>
                                    <Money currency="{{ item.tax.tax_currency }}" >{{ item.tax.tax_amt }}</Money>
                                    <Description xml:lang="{{ item.tax.tax_desc_language }}" >{{ item.tax.tax_desc }}</Description>
                                    {% for tax in item.tax.tax_detail %}
                                        <TaxDetail category="{{ tax_detail.category }}" percentageRate="{{ tax_detail.percent_rate }}" purpose="{{ tax_detail.purpose }}" >
                                            <TaxableAmount>
                                                <Money currency="{{ tax_detail.taxable_currency }}" >{{ tax_detail.taxable_amt }}</Money>
                                            </TaxableAmount>
                                            <TaxAmount>
                                                <Money currency="{{ tax_detail.tax_currency }}" >{{ tax_detail.tax_amt }}</Money>
                                            </TaxAmount>
                                            <TaxLocation xml:lang="{{ tax_detail.tax_location_lang }}" >{{ tax_detail.tax_location }}</TaxLocation>
                                            <Description xml:lang="{{ tax_detail.tax_desc_language }}" >{{ tax_detail.tax_desc }}</Description>
                                        </TaxDetail>
                                    {% endfor %}
                                </Tax>
                            <GrossAmount>
                                <Money currency="{{ item.gross_amt_currency }}" >{{ item.gross_amt }}</Money>
                            </GrossAmount>
                            <NetAmount>
                                <Money currency="{{ item.net_amt_currency }}" >{{ item.net_amt }}</Money>
                            </NetAmount>
                        </InvoiceDetailItem>
                    {% endfor }
                </InvoiceDetailOrder>
                    <InvoiceDetailSummary>
                        <SubtotalAmount>
                            <Money currency="{{ invoice_detail_summary.sub_total_currency }}">{{ invoice_detail_summary.sub_total_amt}}</Money>
                        </SubtotalAmount>
                        <Tax>
                            <Money currency="{{ invoice_detail_summary.tax.tax_currency }}" >{{ invoice_detail_summary.tax.tax_amt }}</Money>
                            <Description xml:lang="{{ invoice_detail_summary.tax.tax_desc_language }}" >{{ invoice_detail_summary.tax.tax_desc }}</Description>
                            {% for tax_detail in tax.tax_detail%}
                                <TaxDetail category="{{ tax_detail.category }}" percentageRate="{{ tax_detail.percent_rate }}" purpose="{{ tax_detail.purpose }}">
                                    <TaxableAmount>
                                        <Money currency="{{ tax_detail.taxable_currency }}" >{{ tax_detail.taxable_amt }}</Money>
                                    </TaxableAmount>
                                    <TaxAmount>
                                        <Money currency="{{ tax_detail.tax_currency }}" >{{ tax_detail.tax_amt}}</Money>
                                    </TaxAmount>
                                    <TaxLocation xml:lang="{{ tax_detail.tax_location_lang }}" >{{ tax_detail.tax_location }}</TaxLocation>
                                    <Description xml:lang="{{ tax_detail.tax_desc_language }}" >{{ tax_detail.tax_desc }}</Description>
                                </TaxDetail>
                            {% endfor %}
                        </Tax>
                        <ShippingAmount>
                            <Money currency="{{ invoice_detail_summary.shipping_currency }}" >{{ invoice_detail_summary.shipping_amt }}</Money>
                        </ShippingAmount>
                        <GrossAmount>
                            <Money currency="{{ invoice_detail_summary.gross_amt_currency }}" >{{ invoice_detail_summary.gross_amt }}</Money>
                        </GrossAmount>
                        <NetAmount>
                            <Money currency="{{ invoice_detail_summary.net_amt }}" >{{ invoice_detail_summary.net_amt }}</Money>
                        </NetAmount>
                        <DueAmount>
                            <Money currency="{{ invoice_detail_summary.due_amt_currency }}" >{{ invoice_detail_summary.due_amt }}</Money>
                        </DueAmount>
                    </InvoiceDetailSummary>
            </InvoiceDetailRequest>
        {% else %}
        <InvoiceDetailRequest></InvoiceDetailRequest>
        {% endfor %}
    </Request>

</cXML>





